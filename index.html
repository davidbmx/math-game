<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>La Gran Aventura de los N√∫meros</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Quicksand", sans-serif;
        background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        overflow-x: hidden;
      }
      h1,
      h2,
      .font-kids {
        font-family: "Fredoka One", cursive;
      }
      .card {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 2rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }
      .btn-bounce:active {
        transform: scale(0.95);
      }
      .floating {
        animation: float 3s ease-in-out infinite;
      }
      @keyframes float {
        0% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-10px);
        }
        100% {
          transform: translateY(0px);
        }
      }
      /* Estilo para el bot√≥n de voz */
      .speak-btn {
        background: #fef3c7;
        border: 2px solid #fbbf24;
        border-radius: 50%;
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
      }
      .speak-btn:hover {
        transform: scale(1.1);
        background: #fde68a;
      }
      .speaking {
        animation: pulse 1s infinite;
      }
      @keyframes pulse {
        0% {
          box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.7);
        }
        70% {
          box-shadow: 0 0 0 10px rgba(251, 191, 36, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(251, 191, 36, 0);
        }
      }
    </style>
  </head>
  <body class="p-4 md:p-8">
    <!-- Pantalla de Inicio -->
    <div
      id="start-screen"
      class="max-w-2xl w-full text-center py-12 card p-8 mt-10"
    >
      <h1 class="text-5xl text-blue-600 mb-4 floating">
        üöÄ Aventura Matem√°tica
      </h1>
      <p class="text-xl text-gray-600 mb-8">
        ¬°Hola, peque√±o explorador! ¬øEst√°s listo para ganar estrellas y aprender?
      </p>
      <button
        onclick="startGame()"
        class="bg-yellow-400 hover:bg-yellow-500 text-white text-2xl px-12 py-4 rounded-full shadow-lg transition-all btn-bounce font-kids"
      >
        ¬°EMPEZAR A JUGAR! üåü
      </button>
    </div>

    <!-- Juego Principal -->
    <div id="game-container" class="hidden max-w-4xl w-full">
      <!-- Encabezado de Estado -->
      <div
        class="flex justify-between items-center mb-6 bg-white p-4 rounded-2xl shadow-sm"
      >
        <div class="flex items-center gap-2">
          <span class="text-3xl">‚≠ê</span>
          <span id="score" class="text-2xl font-kids text-yellow-600">0</span>
        </div>
        <div
          id="game-title"
          class="text-lg font-kids text-blue-500 uppercase tracking-wide text-center px-4"
        ></div>
        <div class="flex items-center gap-2 text-green-600 font-bold">
          Nivel <span id="level-num">1</span>/6
        </div>
      </div>

      <!-- √Årea de Pregunta -->
      <div
        id="question-card"
        class="card p-6 md:p-10 text-center min-h-[400px] flex flex-col justify-center items-center relative"
      >
        <!-- Bot√≥n de lectura -->
        <div class="absolute top-4 right-4">
          <button
            id="voice-trigger"
            class="speak-btn shadow-sm"
            title="Escuchar pregunta"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="#d97706"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
              <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
              <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
            </svg>
          </button>
        </div>

        <div id="question-content" class="w-full">
          <!-- Contenido din√°mico -->
        </div>
      </div>

      <!-- Feedback Mensajes -->
      <div
        id="feedback"
        class="mt-4 h-12 text-center font-bold text-xl transition-all opacity-0"
      ></div>
    </div>

    <!-- Pantalla Final -->
    <div
      id="end-screen"
      class="hidden max-w-2xl w-full text-center py-12 card p-8 mt-10"
    >
      <h2 class="text-4xl text-purple-600 mb-4">üèÜ ¬°Incre√≠ble Trabajo!</h2>
      <p class="text-2xl mb-6">Has completado todos los desaf√≠os.</p>
      <div class="text-6xl mb-6">‚ú® ‚≠ê ‚ú®</div>
      <p class="text-3xl font-kids text-yellow-500 mb-8">
        Puntaje Final: <span id="final-score">0</span>
      </p>
      <button
        onclick="resetGame()"
        class="bg-blue-500 hover:bg-blue-600 text-white text-xl px-10 py-4 rounded-full shadow-lg transition-all btn-bounce font-kids"
      >
        ¬°JUGAR DE NUEVO! üîÑ
      </button>
    </div>

    <script>
      let currentLevel = 1;
      let score = 0;
      let currentAnswer = null;
      let currentQuestionText = "";
      let isSpeaking = false;

      const levels = [
        { id: 1, title: "Series Num√©ricas", type: "series" },
        { id: 2, title: "Anterior y Posterior", type: "neighbors" },
        { id: 3, title: "Suma de Dobles", type: "doubles" },
        { id: 4, title: "La Recta Num√©rica", type: "numberline" },
        { id: 5, title: "Nombres de N√∫meros", type: "names" },
        { id: 6, title: "Problemas de la Vida", type: "problems" },
      ];

      const numberWords = {
        0: "cero",
        1: "uno",
        2: "dos",
        3: "tres",
        4: "cuatro",
        5: "cinco",
        6: "seis",
        7: "siete",
        8: "ocho",
        9: "nueve",
        10: "diez",
        11: "once",
        12: "doce",
        13: "trece",
        14: "catorce",
        15: "quince",
        16: "diecis√©is",
        17: "diecisiete",
        18: "dieciocho",
        19: "diecinueve",
        20: "veinte",
        21: "veintiuno",
        22: "veintid√≥s",
        23: "veintitres",
        24: "veinticuatro",
        25: "veinticinco",
        26: "veintis√©is",
        27: "veintisiete",
        28: "veintiocho",
        29: "veintinueve",
      };

      // Funci√≥n de voz mejorada
      function speakText(text) {
        if (!text || isSpeaking) return;

        window.speechSynthesis.cancel();

        const utterance = new SpeechSynthesisUtterance(text);

        // Buscar una mejor voz (las de Google o Microsoft suelen sonar mejor)
        const voices = window.speechSynthesis.getVoices();
        const preferredVoice =
          voices.find(
            (v) =>
              v.lang.startsWith("es") &&
              (v.name.includes("Google") ||
                v.name.includes("Natural") ||
                v.name.includes("Microsoft"))
          ) ||
          voices.find((v) => v.lang.startsWith("es")) ||
          voices[0];

        if (preferredVoice) utterance.voice = preferredVoice;

        utterance.lang = "es-ES";
        utterance.rate = 0.95; // Velocidad natural
        utterance.pitch = 1.0; // Tono normal (menos rob√≥tico que 1.1)

        const trigger = document.getElementById("voice-trigger");

        utterance.onstart = () => {
          trigger.classList.add("speaking");
          isSpeaking = true;
        };

        utterance.onend = () => {
          trigger.classList.remove("speaking");
          isSpeaking = false;
        };

        utterance.onerror = () => {
          trigger.classList.remove("speaking");
          isSpeaking = false;
        };

        window.speechSynthesis.speak(utterance);
      }

      // Asegurar que las voces est√©n cargadas (algunos navegadores las cargan as√≠ncronamente)
      window.speechSynthesis.onvoiceschanged = () => {
        window.speechSynthesis.getVoices();
      };

      function startGame() {
        document.getElementById("start-screen").classList.add("hidden");
        document.getElementById("end-screen").classList.add("hidden");
        document.getElementById("game-container").classList.remove("hidden");
        loadLevel();
      }

      function resetGame() {
        currentLevel = 1;
        score = 0;
        document.getElementById("score").innerText = "0";
        document.getElementById("end-screen").classList.add("hidden");
        document.getElementById("start-screen").classList.remove("hidden");
      }

      function loadLevel() {
        const container = document.getElementById("question-content");
        const levelInfo = levels[currentLevel - 1];
        document.getElementById("game-title").innerText = levelInfo.title;
        document.getElementById("level-num").innerText = currentLevel;
        container.innerHTML = "";

        if (levelInfo.type === "series") setupSeries();
        if (levelInfo.type === "neighbors") setupNeighbors();
        if (levelInfo.type === "doubles") setupDoubles();
        if (levelInfo.type === "numberline") setupNumberLine();
        if (levelInfo.type === "names") setupNames();
        if (levelInfo.type === "problems") setupProblems();

        document.getElementById("voice-trigger").onclick = () =>
          speakText(currentQuestionText);

        setTimeout(() => speakText(currentQuestionText), 600);
      }

      // --- NIVEL 1: Series ---
      function setupSeries() {
        const container = document.getElementById("question-content");
        const isAscending = Math.random() > 0.5;
        const start = isAscending
          ? Math.floor(Math.random() * 40) + 5
          : Math.floor(Math.random() * 40) + 10;
        const series = [];
        for (let i = 0; i < 4; i++)
          series.push(isAscending ? start + i : start - i);

        const missingIdx = Math.floor(Math.random() * 4);
        currentAnswer = series[missingIdx];
        currentQuestionText = `¬øQu√© n√∫mero falta en la serie que ${
          isAscending ? "sube" : "baja"
        }?`;

        let html = `<h3 class="text-2xl mb-6">${currentQuestionText}</h3>`;
        html += `<div class="flex justify-center gap-4 mb-8">`;
        series.forEach((num, idx) => {
          if (idx === missingIdx) {
            html += `<div class="w-16 h-16 border-4 border-dashed border-blue-400 rounded-xl flex items-center justify-center text-3xl font-kids">?</div>`;
          } else {
            html += `<div class="w-16 h-16 bg-blue-500 text-white rounded-xl flex items-center justify-center text-3xl font-kids shadow-md">${num}</div>`;
          }
        });
        html += `</div>`;
        container.innerHTML = html + generateOptions(currentAnswer);
      }

      // --- NIVEL 2: Anterior/Posterior ---
      function setupNeighbors() {
        const container = document.getElementById("question-content");
        const base = Math.floor(Math.random() * 17) + 2;
        const isBefore = Math.random() > 0.5;
        currentAnswer = isBefore ? base - 1 : base + 1;
        currentQuestionText = `¬øQu√© n√∫mero va ${
          isBefore ? "antes" : "despu√©s"
        } del n√∫mero ${base}?`;

        let html = `<h3 class="text-2xl mb-6">${currentQuestionText}</h3>`;
        html += `<div class="flex justify-center items-center gap-4 mb-8">`;
        if (isBefore) {
          html += `<div class="w-20 h-20 border-4 border-dashed border-yellow-400 rounded-full flex items-center justify-center text-4xl font-kids">?</div><div class="text-4xl">‚û°Ô∏è</div><div class="w-20 h-20 bg-yellow-400 text-white rounded-full flex items-center justify-center text-4xl font-kids shadow-md">${base}</div>`;
        } else {
          html += `<div class="w-20 h-20 bg-yellow-400 text-white rounded-full flex items-center justify-center text-4xl font-kids shadow-md">${base}</div><div class="text-4xl">‚û°Ô∏è</div><div class="w-20 h-20 border-4 border-dashed border-yellow-400 rounded-full flex items-center justify-center text-4xl font-kids">?</div>`;
        }
        html += `</div>`;
        container.innerHTML = html + generateOptions(currentAnswer);
      }

      // --- NIVEL 3: Dobles ---
      function setupDoubles() {
        const container = document.getElementById("question-content");
        const num = Math.floor(Math.random() * 9) + 1;
        currentAnswer = num + num;
        currentQuestionText = `¬øCu√°nto es el doble de ${num}?`;

        let html = `<h3 class="text-3xl mb-8">¬°Poder del Doble! üí™</h3>`;
        html += `<div class="text-6xl font-kids text-purple-600 mb-8">${num} + ${num} = ?</div>`;
        container.innerHTML = html + generateOptions(currentAnswer);
      }

      // --- NIVEL 4: Recta Num√©rica ---
      function setupNumberLine() {
        const container = document.getElementById("question-content");
        const isAddition = Math.random() > 0.5;
        const a = Math.floor(Math.random() * 5) + 4;
        const b = Math.floor(Math.random() * 4) + 1;
        currentAnswer = isAddition ? a + b : a - b;
        currentQuestionText = `Usa la recta num√©rica para resolver: ${a} ${
          isAddition ? "m√°s" : "menos"
        } ${b}.`;

        let html = `<h3 class="text-2xl mb-4">Usa la recta para resolver:</h3>`;
        html += `<div class="text-5xl font-kids text-red-500 mb-6">${a} ${
          isAddition ? "+" : "-"
        } ${b} = ?</div>`;
        html += `<div class="relative w-full max-w-lg h-24 mt-4 flex items-center mb-8 mx-auto"><div class="absolute w-full h-1 bg-gray-400 top-1/2"></div>`;
        for (let i = 0; i <= 10; i++) {
          const isActive = i === a || i === currentAnswer;
          const color =
            i === a
              ? "bg-blue-500"
              : i === currentAnswer
              ? "bg-red-500"
              : "bg-white";
          html += `<div class="absolute flex flex-col items-center" style="left: ${
            i * 10
          }%"><div class="w-8 h-8 rounded-full border-2 border-gray-400 ${color} flex items-center justify-center text-xs font-bold ${
            isActive ? "scale-125 z-10 text-white" : ""
          }">${i}</div></div>`;
        }
        html += `</div>`;
        container.innerHTML = html + generateOptions(currentAnswer);
      }

      // --- NIVEL 5: Nombres de N√∫meros ---
      function setupNames() {
        const container = document.getElementById("question-content");
        const num = Math.floor(Math.random() * 30);
        const showWord = Math.random() > 0.5;

        if (showWord) {
          currentAnswer = num;
          currentQuestionText = `¬øQu√© n√∫mero es el que est√° escrito aqu√≠?`;
          let html = `<h3 class="text-2xl mb-6">¬øQu√© n√∫mero es este?</h3>`;
          html += `<div class="text-4xl font-kids text-green-600 mb-8 capitalize px-4 py-2 bg-green-50 rounded-lg border-2 border-green-200 inline-block">"${numberWords[num]}"</div>`;
          container.innerHTML = html + generateOptions(currentAnswer);
        } else {
          currentAnswer = numberWords[num];
          currentQuestionText = `¬øC√≥mo se escribe el n√∫mero ${num} con letras?`;
          let html = `<h3 class="text-2xl mb-6">¬øC√≥mo se escribe el n√∫mero <b>${num}</b>?</h3>`;
          const options = [numberWords[num]];
          while (options.length < 3) {
            let rand = numberWords[Math.floor(Math.random() * 30)];
            if (!options.includes(rand)) options.push(rand);
          }
          container.innerHTML =
            html + generateButtonGrid(options.sort(() => Math.random() - 0.5));
        }
      }

      // --- NIVEL 6: Problemas Diarios ---
      function setupProblems() {
        const container = document.getElementById("question-content");
        const probType = Math.floor(Math.random() * 3);
        const n1 = Math.floor(Math.random() * 6) + 3;
        const n2 = Math.floor(Math.random() * 3) + 1;

        if (probType === 0) {
          currentQuestionText = `Juan tiene ${n1} manzanas y su mam√° le regala ${n2}. ¬øCu√°ntas tiene ahora?`;
          currentAnswer = n1 + n2;
        } else if (probType === 1) {
          currentQuestionText = `En un √°rbol hab√≠a ${n1} pajaritos. Se volaron ${n2}. ¬øCu√°ntos quedan?`;
          currentAnswer = n1 - n2;
        } else {
          currentQuestionText = `Tengo ${n1} caramelos y quiero darle uno a cada uno de mis ${n2} amigos. ¬øCu√°ntos caramelos me quedar√°n?`;
          currentAnswer = n1 - n2;
        }

        let html = `<div class="bg-blue-50 p-6 rounded-2xl border-2 border-blue-200 mb-8">`;
        html += `<p class="text-2xl text-blue-800 leading-relaxed">${currentQuestionText}</p>`;
        html += `</div>`;
        container.innerHTML = html + generateOptions(currentAnswer);
      }

      function generateOptions(correct) {
        const opts = [correct];
        while (opts.length < 3) {
          let rand =
            correct +
            (Math.floor(Math.random() * 5) + 1) *
              (Math.random() > 0.5 ? 1 : -1);
          if (rand >= 0 && !opts.includes(rand)) opts.push(rand);
        }
        return generateButtonGrid(opts.sort((a, b) => a - b));
      }

      function generateButtonGrid(arr) {
        let html = `<div class="grid grid-cols-1 sm:grid-cols-3 gap-4 w-full">`;
        arr.forEach((opt) => {
          html += `<button onclick="checkAnswer('${opt}')" class="bg-white hover:bg-gray-50 border-4 border-blue-200 text-blue-600 py-4 px-6 rounded-2xl text-3xl font-kids shadow-md transition-all btn-bounce">${opt}</button>`;
        });
        html += `</div>`;
        return html;
      }

      function checkAnswer(val) {
        const feedback = document.getElementById("feedback");
        const isCorrect = val.toString() === currentAnswer.toString();
        feedback.style.opacity = "1";

        if (isCorrect) {
          score += 10;
          document.getElementById("score").innerText = score;
          feedback.innerText = "‚ú® ¬°EXCELENTE! ‚ú®";
          feedback.className =
            "mt-4 h-12 text-center font-bold text-2xl text-green-500 transition-all";
          speakText("¬°Muy bien!");
          setTimeout(() => {
            feedback.style.opacity = "0";
            if (currentLevel < levels.length) {
              currentLevel++;
              loadLevel();
            } else {
              endGame();
            }
          }, 1500);
        } else {
          feedback.innerText = "‚ùå ¬°Int√©ntalo de nuevo!";
          feedback.className =
            "mt-4 h-12 text-center font-bold text-xl text-red-400 transition-all";
          speakText("Intenta otra vez.");
          setTimeout(() => {
            feedback.style.opacity = "0";
          }, 1500);
        }
      }

      function endGame() {
        document.getElementById("game-container").classList.add("hidden");
        document.getElementById("end-screen").classList.remove("hidden");
        document.getElementById("final-score").innerText = score;
        speakText(
          "¬°Felicidades! Has completado todos los desaf√≠os. ¬°Eres un campe√≥n!"
        );
      }
    </script>
  </body>
</html>
